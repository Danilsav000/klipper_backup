[gcode_macro DISABLE_MOTORS]
gcode:
  {% set kinematics = printer["configfile"].config["printer"]["kinematics"] %}
  {% set disable_motor_on_end_print = printer["gcode_macro _USER_VARIABLES"].disable_motor_on_end_print %}

  
  {% if disable_motor_on_end_print %}
        M84
  {% else %}
    {% if kinematics == "corexz" %}
        
        
        SET_STEPPER_ENABLE stepper=extruder enable=0
        SET_STEPPER_ENABLE stepper=stepper_y enable=0
        SET_STEPPER_ENABLE stepper=stepper_x enable=1
        SET_STEPPER_ENABLE stepper=stepper_z enable=1
    {% endif %}
  {% endif %}


