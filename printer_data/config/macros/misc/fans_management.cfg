[gcode_macro FORCE_STOP_FAN]
gcode:

  {% set exhaust_filter_enable = printer["gcode_macro _USER_VARIABLES"].exhaust_filter_enable %}
  {% set part_fan_enabled = printer["gcode_macro _USER_VARIABLES"].part_fan_set %}
  {% set filter_enabled = printer["gcode_macro _USER_VARIABLES"].filter_enabled %}

  {% if exhaust_filter_enable %}
    SET_FAN_SPEED FAN=exhaust_filter SPEED=0.1
  {% endif %}

  {% if part_fan_enabled %}
    M106 S0
  {% endif %}

  {% if filter_enabled %}
    SET_FAN_SPEED FAN=filter_front SPEED=0
    SET_FAN_SPEED FAN=filter_back SPEED=0
  {% endif %}

